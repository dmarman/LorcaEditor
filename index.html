<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>medium editor | demo</title>
    <link rel="stylesheet" href="./css/medium-editor.min.css">
    <link rel="stylesheet" href="./css/demo.css">    
    <link rel="stylesheet" href="./css/beagle.min.css" id="medium-editor-theme">
    <link href="https://fonts.googleapis.com/css?family=Merriweather:300,400" rel="stylesheet">
</head>
<body>
    <button id="correct-button">Correct</button>

    <div id="container">
        <div id="caret" class="editable"></div>
    </div>

    <script src="./js/medium-editor.min.js"></script>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/jquery.blast.min.js"></script>
    <script src="./js/lorca.js"></script>

    <script>
        var timeoutId;
        var editor = new MediumEditor('.editable');

        editor.subscribe('editableInput', function (event, editable) {

        });

        const lorca = new Lorca;

        editor.on($('.editable'), 'keyup', function(event){
            if (timeoutId) clearTimeout(timeoutId);

            timeoutId = setTimeout(function () {
                console.log('saved');
            }, 750);

            if(event.keyCode == 32){
                //console.log("space");
            }

            let plainText = lorca.clean(editor.getContent()).statistics().analysis();
            console.log(plainText);
            //let statistics = silabas(plainText).statistics();
            //let silabasArray = silabas(plainText).syllables();


//            console.log({
//                "sentences": statistics.lines,
//                "words": statistics.words,
//                "syllabes": silabasArray.length,
//            });
        });

        document.getElementById('correct-button').addEventListener('click', function(){
            let sentences = $(".editable").blast({
                delimiter: "sentence",
            });
            let words = $(".editable").blast({
                delimiter: "word",
                generateValueClass: true,
            });

            //http://scielo.isciii.es/pdf/asisna/v31n2/original2.pdf
            //https://github.com/cgiffard/TextStatistics.js
            $('.editable').find('h2, h3, p, span').each(function(){$(this).append(" ")});
            let plainText = editor.getContent().replace(/<(?:.|\n)*?>/gm, '');
            let statistics = silabas(plainText).statistics();
            let silabasArray = silabas(plainText).syllables();
            let fernandez = 206.84 - 60*(silabasArray.length/words.length) - 1.02*(words.length/sentences.length);
            let infz = 206.835 - 62.3*(silabasArray.length/words.length) - words.length/sentences.length;
            let nivel = '';
            let grado = '';

            if(infz > 0 && infz < 40){
                nivel = "Muy difícil";
                grado = "";
            } else if (infz > 40 && infz < 55){
                nivel ="Algo difícil";
                grado = "";
            } else if (infz > 55 && infz < 65){
                nivel ="Normal";
                grado = "";
            } else if (infz > 65 && infz < 80){
                nivel ="Bastante fácil";
                grado = "";
            } else if (infz > 80){
                nivel ="Muy fácil";
                grado = "";
            }

            console.log({
                "sentences": sentences.length,
                "words": words.length,
                "syllables": silabasArray.length,
                "Fernandez Huerta": fernandez,
                "nivel": nivel,
                "INFZ": infz
            });

            $(".editable").blast(false);

            console.log(lorca.clean(editor.getContent()));

        });
    </script>
</body>
</html>
