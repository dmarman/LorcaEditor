<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>medium editor | demo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
    <link rel="stylesheet" href="./css/medium-editor.min.css">
    <link rel="stylesheet" href="./css/demo.css">    
    <link rel="stylesheet" href="./css/beagle.min.css" id="medium-editor-theme">
    <link href="https://fonts.googleapis.com/css?family=Merriweather:300,400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
</head>
<body>
    <!--<button id="correct-button">Correct</button>-->
    <header>
        <div class="navbar">
            <h1 class="app-logo">Lorca</h1>
        </div>
    </header>
    <div class="container" id="container">
        <div class="side-column"></div>
        <div id="caret" class="editable"></div>
        <div id="display" class="side-column">
            <div class="column-wrapper">
                <div class="column-title">Legibilidad</div>
                <div class="meter">
                    <span id="progress-value" style="width: 25%"></span>
                </div>
                <div id="level">Muy fácil</div>
            </div>
            <div id="words">0 palabras</div>
            <div id="sentences">0 frases</div>
            <div id="time">0 segundos</div>
        </div>
    </div>

    <script src="./js/medium-editor.min.js"></script>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/jquery.blast.min.js"></script>
    <script src="./js/lorca.js"></script>

    <script>
        var timeoutId;
        var editor = new MediumEditor('.editable', {
            placeholder: {
                text: 'Escribe aquí'
            }
        });

        editor.subscribe('editableInput', function (event, editable) {

        });

        const lorca = new Lorca;

        editor.on($('.editable'), 'keyup', function(event){
            if (timeoutId) clearTimeout(timeoutId);

            timeoutId = setTimeout(function () {
                console.log('saved');
            }, 750);

            if(event.keyCode == 32){
                //console.log("space");
            }
            let plainText = lorca.clean(editor.getContent()).statistics().analysis();
            console.log(plainText);
            $('#level').text(plainText.infz.level);
            $('#words').text(plainText.content.words.length + ' palabras');
            $('#sentences').text(plainText.content.sentences.length + ' frases');
            $('#time').text(plainText.time);
            $('#progress-value').css('width', plainText.infz.percentage);

            //let statistics = silabas(plainText).statistics();
            //let silabasArray = silabas(plainText).syllables();


//            console.log({
//                "sentences": statistics.lines,
//                "words": statistics.words,
//                "syllabes": silabasArray.length,
//            });
        });

//        document.getElementById('correct-button').addEventListener('click', function(){
//            let sentences = $(".editable").blast({
//                delimiter: "sentence",
//            });
//            let words = $(".editable").blast({
//                delimiter: "word",
//                generateValueClass: true,
//            });
//
//            //http://scielo.isciii.es/pdf/asisna/v31n2/original2.pdf
//            //https://github.com/cgiffard/TextStatistics.js
//            $('.editable').find('h2, h3, p, span').each(function(){$(this).append(" ")});
//            let plainText = editor.getContent().replace(/<(?:.|\n)*?>/gm, '');
//            let statistics = silabas(plainText).statistics();
//            let silabasArray = silabas(plainText).syllables();
//            let fernandez = 206.84 - 60*(silabasArray.length/words.length) - 1.02*(words.length/sentences.length);
//            let infz = 206.835 - 62.3*(silabasArray.length/words.length) - words.length/sentences.length;
//            let nivel = '';
//            let grado = '';
//
//            if(infz > 0 && infz < 40){
//                nivel = "Muy difícil";
//                grado = "";
//            } else if (infz > 40 && infz < 55){
//                nivel ="Algo difícil";
//                grado = "";
//            } else if (infz > 55 && infz < 65){
//                nivel ="Normal";
//                grado = "";
//            } else if (infz > 65 && infz < 80){
//                nivel ="Bastante fácil";
//                grado = "";
//            } else if (infz > 80){
//                nivel ="Muy fácil";
//                grado = "";
//            }
//
//            console.log({
//                "sentences": sentences.length,
//                "words": words.length,
//                "syllables": silabasArray.length,
//                "Fernandez Huerta": fernandez,
//                "nivel": nivel,
//                "INFZ": infz
//            });
//
//            $(".editable").blast(false);
//
//            console.log(lorca.clean(editor.getContent()));
//
//        });
    </script>
</body>
</html>
